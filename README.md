# **rbch**

**rbch** — это простая реализация блокчейна и криптовалюты на языке Rust. Проект включает в себя базовые элементы блокчейна, такие как блоки и транзакции, а также функционал для майнинга новых блоков и управления кошельками.

## Обзор проекта

Проект включает в себя следующие ключевые компоненты:

- **Блоки**: Хранят данные, такие как индекс, временная метка, данные блока, хэш предыдущего блока, хэш текущего блока и nonce.
- **Блокчейн**: Управляет цепочкой блоков, транзакциями и вознаграждениями.
- **Транзакции**: Определяют переводы токенов между кошельками.
- **Кошельки**: Хранят информацию о балансе и адресе.

## Установка и настройка

1. **Клонируйте репозиторий**:

    ```sh
    git clone <URL вашего репозитория>
    cd <имя репозитория>
    ```

2. **Убедитесь, что у вас установлен Rust**. Если не установлен, следуйте инструкциям на официальном сайте [rust-lang.org](https://www.rust-lang.org/).

3. **Установите зависимости и соберите проект**:

    ```sh
    cargo build
    ```

4. **Запустите проект**:

    ```sh
    cargo run
    ```

## Структура проекта

Проект имеет следующую структуру:

- `Cargo.toml` — файл конфигурации Cargo, управляющий зависимостями и метаданными проекта.
- `src/main.rs` — основной файл с логикой запуска приложения.
- `src/block.rs` — определяет структуру и логику блоков в блокчейне.
- `src/blockchain.rs` — реализует логику блокчейна, включая добавление блоков и управление транзакциями.
- `src/transaction.rs` — определяет структуру транзакций.
- `src/wallet.rs` — управляет кошельками и их балансами.
- `src/miner.rs` — реализует логику майнинга блоков.
- `src/network.rs` — управляет сетевыми операциями (простой пример).

## Использование

1. **Создание нового блока**:

    Вызовите метод `add_block` на объекте `Blockchain`, чтобы добавить новый блок.

    ```rust
    blockchain.add_block("Данные для блока".to_string(), "адрес_майнера".to_string(), vec![]);
    ```

2. **Получение баланса кошелька**:

    Используйте метод `get_wallet_balance` для получения баланса кошелька по адресу.

    ```rust
    let balance = blockchain.get_wallet_balance("адрес_кошелька");
    ```

3. **Сохранение и загрузка блокчейна**:

    - **Сохранение**:

        ```rust
        blockchain.save_to_files().expect("Ошибка при сохранении блокчейна");
        blockchain.save_wallets_to_file().expect("Ошибка при сохранении кошельков");
        ```

    - **Загрузка**:

        ```rust
        let blockchain = Blockchain::load_from_files().unwrap_or_else(|_| Blockchain::new());
        ```

## API и модули

### `block.rs`

- **Структура `Block`**:
  - `index`: Уникальный индекс блока в цепочке.
  - `timestamp`: Временная метка блока.
  - `data`: Данные, хранящиеся в блоке.
  - `previous_hash`: Хэш предыдущего блока.
  - `hash`: Хэш текущего блока.
  - `nonce`: Значение nonce для процесса майнинга.
  - `transactions`: Вектор транзакций, связанных с блоком.

- **Методы**:
  - `new(index, data, previous_hash, transactions)`: Создает новый блок и запускает процесс майнинга.
  - `calculate_hash()`: Рассчитывает хэш блока.
  - `mine_block()`: Запускает процесс майнинга до тех пор, пока хэш блока не будет удовлетворять сложности.

### `blockchain.rs`

- **Структура `Blockchain`**:
  - `chain`: Вектор блоков в блокчейне.
  - `wallets`: Вектор кошельков.

- **Методы**:
  - `new()`: Создает новый блокчейн с начальным генезис-блоком.
  - `get_latest_block()`: Возвращает последний блок в цепочке.
  - `add_block(data, miner_address, transactions)`: Добавляет новый блок в цепочку и вознаграждает майнера.
  - `get_wallet(address)`: Возвращает индекс кошелька по адресу, или создает новый и возвращает его индекс.
  - `set_wallet_balance(address, balance)`: Устанавливает баланс кошелька по адресу.
  - `get_wallet_balance(address)`: Возвращает баланс кошелька по адресу.
  - `save_to_files()`: Сохраняет состояние блокчейна и кошельков в файлы.
  - `load_from_files()`: Загружает состояние блокчейна и кошельков из файлов.
  - `is_chain_valid()`: Проверяет валидность цепочки блоков.

### `transaction.rs`

- **Структура `Transaction`**:
  - `from`: Адрес отправителя.
  - `to`: Адрес получателя.
  - `amount`: Сумма перевода.

- **Методы**:
  - `new(from, to, amount)`: Создает новую транзакцию.

### `wallet.rs`

- **Структура `Wallet`**:
  - `address`: Адрес кошелька.
  - `balance`: Баланс кошелька.

- **Методы**:
  - `new(address)`: Создает новый кошелек с начальным балансом 0.

### `miner.rs`

- **Структура `Miner`**:
  - `address`: Адрес майнера.

- **Методы**:
  - `new(address)`: Создает нового майнера с указанным адресом.
  - `mine_block(blockchain, data, transactions)`: Создает и майнит новый блок, добавляя его в блокчейн.

### `network.rs`

- **Структура `Network`**:
  - `new()`: Создает новый объект сети.

- **Методы**:
  - `start()`: Запускает сетевые операции (простой пример).

## Тестирование

Проект включает в себя модульные тесты для проверки функциональности, включая создание блоков, майнинг, транзакции и проверку валидности цепочки.

## Ссылки и ресурсы

- [Rust Programming Language](https://www.rust-lang.org/)
- [Serde for Serialization/Deserialization](https://serde.rs/)
- [SHA-256 Hashing Algorithm](https://en.wikipedia.org/wiki/SHA-2)

